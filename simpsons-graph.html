<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpson's Paradox - UC Berkeley Gender Bias Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-regression"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="styles.css" />

    <style>
        /* Styling for Info Button */
        .info-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            cursor: pointer;
            font-size: 20px;
            line-height: 28px;
        }

        /* Styling for Modal (Popup) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            text-align: left;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-content h3 {
            margin-top: 0;
        }

        .close-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }

        .toggle-button {
            margin-left: 10px;
        }
    </style>

</head>
<body>



    <h2 style="margin-top: 20px; margin-left: 10px;">Simpson's Paradox: UC Berkeley Gender Bias Example</h2>
    <button class="toggle-button" onclick="toggleView()">Toggle Overall/Grouped Data</button>
    <canvas id="berkeleyChart"></canvas>

     <!-- Info Button -->
     <button class="info-button" onclick="openModal()">i</button>

     <!-- Modal for Explanation -->
     <div id="infoModal" class="modal">
         <div class="modal-content">
             <button class="close-button" onclick="closeModal()">Close</button>
             <h3>Simpson's Paradox: Explanation</h3>
             <br>
             <p>
                 This chart illustrates the <b>Simpson's Paradox</b> using the UC Berkeley Gender Bias problem. 
                 In this example, it appeared that <b>women had lower admission rates</b> compared to men. 
                 However, when splitting the data by department, <b>women had equal or better 
                 acceptance rates</b> in almost every department.
             </p>
             <br>
             <p>
                 The paradox occured because <b>women applied to more competitive departments</b> with 
                 lower acceptance rates, while <b>men applied to less competitive departments</b>. 
                 This aggregated data highlighted a misleading trend. It was actually the case that
                 <b>women were admitted at a higher rate</b> within each department, but because more women 
                 applied to more competitive departments, <b>the overall rate was lower.</b>
             </p>
             <br>
             <p>
                 This example highlights the importance of <b>analysing data in subgroups</b> to avoid 
                 incorrect conclusions and biased AI models.
                 <br><br>
                 <b>Overall Data View:</b> Women appear to be admitted at a lower rate, shown by the line sloping downwards.
                 <br>
                 <b>Grouped Data View:</b> Women had equal or higher admission rates in every department, shown by both lines sloping upwards.

             </p>
         </div>
     </div>

    <script>
        const ctx = document.getElementById("berkeleyChart").getContext("2d");

        // ðŸ”¹ UC Berkeley Gender Bias Data (Improved Version)
        const overallData = [
            { x: 300, y: 30 }, { x: 500, y: 40 }, 
            { x: 800, y: 35 }, { x: 1200, y: 25 }
        ];

        const groupedData = {
            men: [
                { x: 300, y: 25 }, { x: 500, y: 35 }, 
                { x: 800, y: 45 }, { x: 1200, y: 50 }
            ],
            women: [
                { x: 300, y: 35 }, { x: 500, y: 45 }, 
                { x: 800, y: 55 }, { x: 1200, y: 60 }
            ]
        };

        let isGrouped = false;

        // ðŸ”¹ Function to Generate Annotations
        function generateAnnotations() {
            if (isGrouped) {
                return {
                    menLabel: {
                        type: "label",
                        content: ["Men's Trend", "(Increasing Admission Rate)"],
                        xValue: 800,
                        yValue: 45,
                        backgroundColor: "rgba(0,0,255,0.8)",
                        color: "white",
                        padding: 6
                    },
                    womenLabel: {
                        type: "label",
                        content: ["Women's Trend", "(Increasing Admission Rate)"],
                        xValue: 800,
                        yValue: 55,
                        backgroundColor: "rgba(255,0,0,0.8)",
                        color: "white",
                        padding: 6
                    }
                };
            } else {
                return {
                    overallLabel: {
                        type: "label",
                        content: ["Overall Trend", "(Appears to show Bias)"],
                        xValue: 800,
                        yValue: 35,
                        backgroundColor: "rgba(0,128,0,0.8)",
                        color: "white",
                        padding: 6
                    }
                };
            }
        }

        // ðŸ”¹ Chart Options with Dynamic Annotations
        function getChartOptions() {
            return {
                plugins: {
                    regression: true,
                    annotation: {
                        annotations: generateAnnotations()
                    }
                },
                scales: {
                    x: {
                        type: "linear",
                        position: "bottom",
                        title: { display: true, text: "Number of Applicants" },
                        min: 200,
                        max: 1400
                    },
                    y: {
                        type: "linear",
                        title: { display: true, text: "Admission Rate (%)" },
                        min: 20,
                        max: 70
                    }
                }
            };
        }

        // ðŸ”¹ Function to Create the Chart
        function createChart(data) {
            return new Chart(ctx, {
                type: "line",
                data: { datasets: data },
                options: getChartOptions()
            });
        }

        // ðŸ”¹ Initial View (Overall Data)
        let chart = createChart([
            { 
                label: "Overall Data", 
                data: overallData, 
                backgroundColor: "green",
                borderColor: "green",
                showLine: true,
                fill: false,
                regression: true,
                regressionLine: { color: "green" }  
            }
        ]);

        // ðŸ”¹ Toggle Button Logic
        function toggleView() {
            isGrouped = !isGrouped;
            chart.destroy();

            if (isGrouped) {
                chart = createChart([
                    { 
                        label: "Men", 
                        data: groupedData.men, 
                        backgroundColor: "blue",
                        borderColor: "blue",
                        showLine: true,
                        fill: false,
                        regression: true,
                        regressionLine: { color: "blue" }  
                    },
                    { 
                        label: "Women", 
                        data: groupedData.women, 
                        backgroundColor: "red",
                        borderColor: "red",
                        showLine: true,
                        fill: false,
                        regression: true,
                        regressionLine: { color: "red" }  
                    }
                ]);
            } else {
                chart = createChart([
                    { 
                        label: "Overall Data", 
                        data: overallData, 
                        backgroundColor: "green",
                        borderColor: "green",
                        showLine: true,
                        fill: false,
                        regression: true,
                        regressionLine: { color: "green" }  
                    }
                ]);
            }
        }

         // ðŸ”¹ Modal Logic
         function openModal() {
            document.getElementById("infoModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("infoModal").style.display = "none";
        }
    </script>
</body>
</html>
